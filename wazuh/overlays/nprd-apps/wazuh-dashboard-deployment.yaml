# Wazuh Dashboard Deployment
#
# This is a placeholder. Replace with actual Wazuh Dashboard Deployment
# from the official wazuh-kubernetes repository.
#
# Key requirements:
# - Stateless deployment (no persistent storage needed)
# - Mount TLS certificates from secret
# - Set appropriate resource limits
# - Connect to wazuh-indexer service
#
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wazuh-dashboard
  namespace: managed-tools
  labels:
    app: wazuh
    component: dashboard
    managed-by: gitops
spec:
  replicas: 1
  selector:
    matchLabels:
      app: wazuh
      component: dashboard
  template:
    metadata:
      labels:
        app: wazuh
        component: dashboard
        managed-by: gitops
    spec:
      containers:
      - name: wazuh-dashboard
        image: wazuh/wazuh-dashboard:4.10.3
        # Using 4.10.3 due to x86-64-v2 CPU requirement in versions 4.11.0+
        # Cluster nodes don't support x86-64-v2, causing "Fatal glibc error"
        # 4.10.3 is the last 4.10.x release and may work on older CPUs
        ports:
        - containerPort: 5601
          name: http
        volumeMounts:
        - name: certs
          mountPath: /etc/wazuh-dashboard/certs/dashboard.pem
          subPath: wazuh-dashboard.pem
          readOnly: true
        - name: certs
          mountPath: /etc/wazuh-dashboard/certs/dashboard-key.pem
          subPath: wazuh-dashboard-key.pem
          readOnly: true
        - name: certs
          mountPath: /etc/wazuh-dashboard/certs/root-ca.pem
          subPath: root-ca.pem
          readOnly: true
      volumes:
      - name: certs
        secret:
          secretName: wazuh-certs
