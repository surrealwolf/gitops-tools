apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: github-runner-deployment
  namespace: managed-cicd
spec:
  # Initial replicas - will be managed by HorizontalRunnerAutoscaler
  replicas: 1
  template:
    spec:
      # Organization-level runner (available to all repos in org)
      # Runners are assigned to a runner group for access control
      # The runner group must be created in GitHub UI first:
      # Settings > Actions > Runner groups > New runner group
      organization: DataKnifeAI
      
      # Runner group name (must exist in GitHub org settings)
      # Create this group in: https://github.com/organizations/DataKnifeAI/settings/actions/runners
      # Configure it to allow "All repositories" or select specific repos
      # Note: Some ARC versions use "group" instead of "runnerGroup"
      group: NRPD Auto Scale
      
      # Alternative: Repository-level runner (attached to a specific repository)
      # repository: DataKnifeAI/gitops-tools
      
      # Alternative: Enterprise-level runner (available across enterprise)
      # enterprise: <YOUR_ENTERPRISE_NAME>
      
      # Runner labels (optional)
      # IMPORTANT: Actions Runner Controller does NOT support multiple labels
      # See: https://docs.github.com/en/actions/how-tos/manage-runners/self-hosted-runners/apply-labels
      # Use only a single label that matches your workflow's runs-on requirement
      labels:
        - self-hosted
      
      # Docker image for runner
      image: summerwind/actions-runner:latest
      
      # Resources for runner pod
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: "2"  # Use normalized format to match Kubernetes (2000m = 2)
          memory: 4Gi
      
      # Environment variables (optional)
      # Note: RUNNER_NAME is set per-pod by ARC, don't override
      # This allows each runner to have a unique name
      
      # Ephemeral runners - clean up after job completion
      # This ensures runners don't accumulate and prevents replica buildup
      ephemeral: true
      
      # Note: registrationTimeout is not a valid field on RunnerDeployment
      # The timeout is managed by the controller (default 10m)
      # Ephemeral runners will help prevent the buildup issue
