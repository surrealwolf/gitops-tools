name: Test Runner

on:
  workflow_dispatch:
  push:
    branches:
    - main
permissions:
  contents: read
  actions: read
jobs:
  test-runner:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Display runner info
      run: 'echo "Runner OS: $(uname -a)"

        echo "Runner hostname: $(hostname)"

        echo "Working directory: $(pwd)"

        echo "Runner labels: ${{ runner.labels }}"

        echo "Runner name: ${{ runner.name }}"

        '
    - name: Test basic commands
      run: 'echo "Testing basic commands..."

        echo "Date: $(date)"

        echo "Uptime: $(uptime)"

        echo "Docker context:"

        docker context ls || echo "docker not available"

        '
    - name: Test environment
      run: 'echo "Environment variables:"

        env | grep -E "RUNNER|GITHUB|CI" | sort

        '
    - name: Success message
      run: 'echo "âœ… GitHub runner is working correctly!"

        echo "Runner successfully executed all test steps."

        '
  push-to-gitlab:
    name: Push to GitLab
    runs-on: ubuntu-latest
    needs:
    - test-runner
    if: always() && needs.test-runner.result == "success"
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    - name: Push to GitLab
      env:
        GITLAB_TOKEN: ${{ secrets.GITLAB_TOKEN }}
      run: 'git config user.name "GitHub Actions"

        git config user.email "actions@github.com"

        git push https://oauth2:${GITLAB_TOKEN}@gitlab.com/dk-raas/dkai/devops/gitops-tools.git HEAD:main --force || echo "GitLab push failed"'
